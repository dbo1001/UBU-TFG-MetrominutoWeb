<!DOCTYPE html>
<html lang="en">
<head>
    <title>Simple Map</title>
    <meta name="viewport" content="initial-scale=1.0">
    <meta charset="utf-8">
    <style>
        /* Always set the map height explicitly to define the size of the div
         * element that contains the map. */
        #map {
            width:  720px;
            height: 500px;
        }

        #directions-panel {
            margin-top: 10px;
            background-color: #FFEE77;
            padding: 10px;
            overflow: scroll;
            height: 174px;
            width: 600px;
        }

        /* Optional: Makes the sample page fill the window. */
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
        }
    </style>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBa4H59vDquLKttwMkxv0WaJrx3wXB260s"> type="text/javascript"</script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
</head>
<body>
{#<script>
    var markers = [];
    var labels = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
    var labelIndex = 0;



</script>#}

<form>
    <div id="map"></div>
    <input type='button' value='Show' id='showButton'>
    <input type='button' value='Delete' id='removeButton'>
    <input type='button' value='Save' id='saveButton'>
    <input type='button' value='Draw' id='drawButton'>
    <div id = "directions"></div>
</form>
</body>
</html>
<script>
    $(document).ready(function boxes(){
            var directionsService = new google.maps.DirectionsService();
            var directionsRenderer = new google.maps.DirectionsRenderer();
        var markers = [];
        var labels = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
        var labelIndex = 0;

        $("#showButton").click(function () {
            showMarkersDiv();
        });
        $("#removeButton").click(function () {
            deleteMarkers();
        });
        $("#saveButton").click(function () {
            //alert(markers[0].label);
            var list = []
            for(i=0;i<markers.length;i++){
                list.push(markers[i].position);
            }
            //alert(list);
            $.ajax({
                type: "POST",
                contentType: "application/json;charset=utf-8",
                {#url: "/getMarks",#}
                traditional: "true",
                data: JSON.stringify(list),
                dataType: "json"
            });
        });
        $("#drawButton").click(function () {
            draw_route();
        });

        function initMap() {
            //var myLatLng = {lat: 42.34, lng: -3.69};

            var myLatLng = {lat: {{latitud}}, lng: {{longitud}} }
            var map = new google.maps.Map(document.getElementById('map'), {
                zoom: 12,
                center: myLatLng
            });

            google.maps.event.addListener(map, 'click', function(event) {
                addMarker(event.latLng, map);
            });

            var marker = new google.maps.Marker({
                position: {lat: 42.343455, lng: -3.702989},
                map: map,
                title : "A"
            });
            directionsRenderer.setMap(map);
        }

        function addMarker(location, map) {
            var marker = new google.maps.Marker({
                position: location,
                label: labels[labelIndex++ % labels.length],
                map: map
            });
            markers.push(marker);
        }

        function setMapOnAll(map) {
            for (var i = 0; i < markers.length; i++) {
                markers[i].setMap(map);
            }
        }

        function clearMarkers() {
            setMapOnAll(null);
        }

        // Deletes all markers in the array by removing references to them.
        function deleteMarkers() {
            clearMarkers();
            markers = [];
            labelIndex = 0;
        }

        function showMarkersDiv() {
            var summaryPanel = document.getElementById('directions');
            // summaryPanel.innerHTML = '';
            for (var i=0;i<markers.length;i++){
                summaryPanel.innerHTML += markers[i].label + ': ' + markers[i].position + '<br>';
            }
        }
        function draw_route(){
            var start = markers[0].position;
            var end = markers[1].position;
            var request = {
                origin: start,
                destination: end,
                travelMode: 'DRIVING'
            };
            directionsService.route(request, function(result, status) {
                if (status == 'OK') {
                    directionsRenderer.setDirections(result);
                }
            });
        }
        google.maps.event.addDomListener(window, 'load', initMap);
    });
</script>